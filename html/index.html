<script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
<!-- <script src="../js/d3.js" charset="utf-8"></script> -->
<script src="../js/main.js"></script>
<svg id="content" width="1000" height="500"></svg>
<script text="script">
  var data_set = {
    // name: "main",
    children: [
      {
        name: "1",
        children: [
          { name: "1aaa", val: 50 },
          { name: "1bbb", val: 50 },
        ],
      },
      {
        name: "2",
        children: [
          { name: "2aaa", val: 50 },
          { name: "2bbb", val: 50 },
          { name: "2ccc", val: 50 },
          { name: "2ddd", val: 50 },
          { name: "2eee", val: 50 },
          { name: "2fff", val: 50 },
        ],
      },
      {
        name: "3",
        children: [
          { name: "3aaa", val: 50 },
          { name: "3bbb", val: 50 },
          { name: "3ccc", val: 50 },
          { name: "3ddd", val: 50 },
          { name: "3eee", val: 50 },
          { name: "3fff", val: 50 },
          { name: "3g", val: 50 },
          { name: "3hhhhh", val: 50 },
          { name: "3iiiiiiiiii", val: 50 },
        ],
      },
      {
        name: "4",
        children: [
          { name: "4aaa", val: 50 },
          { name: "4bbb", val: 50 },
          { name: "4ccc", val: 50 },
          { name: "4ddd", val: 50 },
          { name: "4eee", val: 50 },
          { name: "4fff", val: 50 },
          { name: "4g", val: 50 },
          { name: "4hhhhh", val: 50 },
          { name: "4iiiiiiiiii", val: 50 },
        ],
      },
    ],
  };
  // var data_set = {
  //   name: "main",
  //   children: [
  //     { name: "aaa", val: 50 },
  //     { name: "bbb", val: 50 },
  //     { name: "ccc", val: 50 },
  //     // { name: "main", val: 200 },
  //     { name: "ddd", val: 50 },
  //     { name: "eee", val: 50 },
  //     { name: "fff", val: 50 },
  //     { name: "fff", val: 50 },
  //   ],
  // };

  var width = 1000,
    height = 500;

  var bubble = d3.pack().size([width, height]).padding(20);
  // var bubble = d3.pack().size([width, height]).padding(20);

  var nodes = d3.hierarchy(data_set).sum(function (d) {
    return d.val;
  });
  var bubble_data = bubble(nodes).descendants();

  var no_root_bubble = bubble_data.filter(function (d) {
    return d.parent != null;
    return true;
  });

  var max_val = d3.max(no_root_bubble, function (d) {
    return d.r;
  });
  var min_val = d3.min(no_root_bubble, function (d) {
    return d.r;
  });

  var color_scale = d3
    .scaleLinear()
    .domain([min_val, max_val])
    .range(d3.schemeCategory10);
  var font_scale = d3.scaleLinear().domain([min_val, max_val]).range([9, 28]);

  var bubbles = d3
    .select("#content")
    .selectAll(".bubble")
    .data(no_root_bubble)
    .enter()
    .append("g")
    .attr("class", "bubble")
    .attr("transform", function (d) {
      return "translate(" + d.x + "," + d.y + ")";
    });
  bubbles
    .append("circle")
    .attr("r", function (d) {
      return d.r;
    })
    .style("fill", function (d, i) {
      return color_scale(d.r);
    })
    .style("opacity", 0.1);
  bubbles
    .append("text")
    .attr("text-anchor", "middle")
    .attr("dominant-baseline", "central")
    .text(function (d) {
      return d.data.name;
    })
    .style("font-size", function (d) {
      return font_scale(d.r);
    });
</script>
